<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://use.typekit.net/qxd3iug.css">
</head>

<body>
    <header></header>
    <section id="store_section">
        <div class="store_container">
        </div>

        <div id="tooltip">
            <p id="navn_hover"></p>
            <p id="pris_hover"></p>
        </div>
    </section>
</body>
<footer></footer>

<template>
    <div class="produkt_container">
        <img src="" alt="">
        <div class="infobox">
            <p class="navn"></p>
            <p class="pris"></p>
        </div>
    </div>
</template>

<script src="script.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", getTheContent);


    async function getTheContent() {
        let pods;
        let url = "https://mathaeusss.dk/kea/2_semester/nam_le/wordpress/wp-json/wp/v2/store";
        const temp = document.querySelector("template");
        const container = document.querySelector(".store_container");
        let jsonData = await fetch(url);
        pods = await jsonData.json();

        //For hvert pod
        pods.forEach(pod => {
            //kloner vi templaten fra html'en
            let klon = temp.cloneNode(true).content;
            //og indsætter de vores endpoints i de tilhørende tags i templatet.
            klon.querySelector(".navn").textContent = pod.navn;
            klon.querySelector(".pris").textContent = pod.pris;
            klon.querySelector("img").src = pod.billede.guid;

            //Hvis podded har kategorien "produkt" (json spytter tallet 3 ud)
            if (pod.kategori == 3) {
                //(img'en bliver indsat i varabel for lethedens skyld)
                let produkt = klon.querySelector("img");

                //Styler vi tagget så det ser klikbart ud,
                produkt.style.cursor = "pointer";
                //lytter på klik til singleview
                produkt.addEventListener("click", singleView);
                //lytter på hover ift tooltip (tooltip er det man kalder en hover-infobox  - vi ku kalde den hvad som helst)
                produkt.addEventListener("mouseover", e => toolTip(e));
                //lytter på vi fjerner musen igen så vi kan fjerne tooltip
                produkt.addEventListener("mouseout", hideTooltip);
                //Indsætter nedenstående data-atributter som vi skal bruge i senere funktioner
                produkt.dataset.navn = pod.navn;
                produkt.dataset.pris = pod.pris;
                produkt.dataset.id = pod.id;
            }

            //Når tamplatet er udfyldt, indsættes det i vores container i html'en
            container.appendChild(klon);
        });


    }


    //Tidligere nævnte data-attribut (produktets id) indsættes i singleview-url'en som et id. Derved kan id'et efterfølgende hentes ned med java i singleview.html
    function singleView() {
        let id = this.dataset.id;
        window.location.href = "view.html?id=" + id;
    }



    //Mouse over funtionen indhenter dataset-navn og pris fra produktet og indsætter det i tooltip-boxen. Boxen vises.
    function toolTip(e) {
        document.querySelector("#navn_hover").textContent = e.target.dataset.navn;
        document.querySelector("#pris_hover").textContent = e.target.dataset.pris;

        document.querySelector("#tooltip").classList.add("show_tooltip");
    }


    //Mouse-out funtionen fjerner tooltip-boxen.
    function hideTooltip() {
        document.querySelector("#tooltip").classList.remove("show_tooltip");
    }



    let y;
    let x;
    let toolTipPos = document.querySelector("#tooltip");

    //Når musen bevæges indhentes musens x og y værdi. Disse værdier sættes = tooltip-boxens position.
    window.onmousemove = function(e) {
        x = e.clientX;
        y = e.clientY;
        toolTipPos.style.top = (y + 20) + 'px';
        toolTipPos.style.left = (x + 20) + 'px';
    };

</script>

</html>
